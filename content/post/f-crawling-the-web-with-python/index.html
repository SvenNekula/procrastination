---
title: '[F] Crawling the web with Python'
author: 'Sven '
date: '2021-04-08'
slug: []
categories:
  - Python
tags:
  - webcrawler
---

<script src="{{< blogdown/postref >}}index_files/header-attrs/header-attrs.js"></script>


<p>Hello again! Unfortunately I caught the corona virus a few weeks back and thus
had to stay in quarantine for ~2 weeks. Quarantine sucks, but at least I used
the time to get my python skills back up to par.</p>
<div id="the-project" class="section level1">
<h1>The project</h1>
<p>I wanted to create a webcrawler using python. Being a fun project, I used a website with data from all the pokemon to crawl the data and write it to a csv file.
During the process I found two ways to do so.
The first way required more code than the second one. But I will show you both.</p>
</div>
<div id="v1" class="section level1">
<h1>V1</h1>
<p>As usual we have to load the modules first.</p>
<pre class="python"><code>import requests
from bs4 import BeautifulSoup</code></pre>
<p>Next up we have to set the url and use the request package to make a http request.</p>
<pre class="python"><code>url = &#39;https://pokemondb.net/pokedex/all&#39;
r = requests.get(url)</code></pre>
<p>You can check if the request was successfull by printing the status code using
the command print(r.status_code). If the status-code is 200 you’re good. After
creating the request and checking if it was successfull we have to use the
‘BeautifulSoup’ module to parse the website’s html file.</p>
<pre class="python"><code>soup = BeautifulSoup(r.text, &#39;html.parser&#39;)</code></pre>
<p>After parsing the html file we can start to look for the data. In our case the
data is in a html-table, which we can find using the .find command.</p>
<pre class="python"><code>pokemon_table = soup.find(&#39;table&#39;, class_ = &#39;data-table block-wide&#39;)</code></pre>
<p>Now that we found the html-table we can make a list using a for loop. The
columns of the table have different classes however, which we can find by
inspecting the website using our web-browser. There were 3 different classes:
‘cell-name’, ‘cell-total’ and ‘cell-num’. There were 7 different elements of the
‘cell-num’-class, so we had to further inspect those elements, to get the right ones.
Having done that, we can create the list.</p>
<pre class="python"><code>pokemon_list = []
for pkmn in pokemon_table.find_all(&#39;tbody&#39;):
    rows = pkmn.find_all(&#39;tr&#39;)
    for row in rows:
        p_name = row.find(&#39;td&#39;, class_ = &#39;cell-name&#39;).text
        p_total = row.find(&#39;td&#39;, class_ = &#39;cell-total&#39;).text
        p_hp = row.find_all(&#39;td&#39;, class_ = &#39;cell-num&#39;)[1].text
        p_att = row.find_all(&#39;td&#39;, class_ = &#39;cell-num&#39;)[2].text
        p_def = row.find_all(&#39;td&#39;, class_ = &#39;cell-num&#39;)[3].text
        p_spatk = row.find_all(&#39;td&#39;, class_ = &#39;cell-num&#39;)[4].text
        p_spdef = row.find_all(&#39;td&#39;, class_ = &#39;cell-num&#39;)[5].text
        p_speed = row.find_all(&#39;td&#39;, class_ = &#39;cell-num&#39;)[6].text
        pokemon_list.append([p_name, p_total, p_hp, p_att, p_def, p_spatk, p_spdef, p_speed])</code></pre>
<p>The last step is to convert this list into a csv-file. We can do this with the help
of the csv module.</p>
<pre class="python"><code>import csv
with open(&#39;allpokemon.csv&#39;, &#39;w&#39;, newline=&#39;&#39;) as csvfile:
    pkmnwriter = csv.writer(csvfile, delimiter=&#39;;&#39;,
                            quotechar=&#39;&quot;&quot;&#39;, quoting=csv.QUOTE_MINIMAL)
    
    for row in pokemon_list:
        pkmnwriter.writerow</code></pre>
<p>Now we successfully transformed the website’s data into a csv-file!</p>
</div>
<div id="v2" class="section level1">
<h1>V2</h1>
<p>The second way of transforming the website’s data into a csv is a lot easier.
It only requires 4 lines of code, because we’re using pandas’ read_html function.
This function automatically scans the website for html-tables and converts them to
a list. One thing to keep in mind is to use the requests module the same way we used
it in V1, otherwise you might encounter some errors!</p>
<pre class="python"><code>import pandas as pd

pkmn_list = pd.read_html(r.text)
df = pd.DataFrame(pkmn_list[0])

df.to_csv (r&#39;P:\\GitHub\\webcrawler\\pokemon_list.csv&#39;, index = False, header=True)</code></pre>
<p>Those were 2 ways to crawl data from a website. Now we can further use the data
and analyze it.</p>
</div>
<div id="analyzing-the-data" class="section level1">
<h1>Analyzing the data</h1>
<p>Before analyzing the data I opened the csv file in excel and transformed it to
a .xslx file, because it makes it easier to work with (in excel).
To load the .xslx file into RStudio I used the ‘readxl’ package. I also used
‘dplyr’ and ‘ggplot2’ to filter and visualize the data.</p>
<pre><code>## 
## Attache Paket: &#39;dplyr&#39;</code></pre>
<pre><code>## The following objects are masked from &#39;package:stats&#39;:
## 
##     filter, lag</code></pre>
<pre><code>## The following objects are masked from &#39;package:base&#39;:
## 
##     intersect, setdiff, setequal, union</code></pre>
<p>Now we can get an overview of the data.</p>
<pre class="r"><code>#overview of data
str(pData)</code></pre>
<pre><code>## tibble[,10] [1,045 x 10] (S3: tbl_df/tbl/data.frame)
##  $ #      : num [1:1045] 1 2 3 3 4 5 6 6 6 7 ...
##  $ Name   : chr [1:1045] &quot;Bulbasaur&quot; &quot;Ivysaur&quot; &quot;Venusaur&quot; &quot;Venusaur Mega Venusaur&quot; ...
##  $ Type   : chr [1:1045] &quot;Grass Poison&quot; &quot;Grass Poison&quot; &quot;Grass Poison&quot; &quot;Grass Poison&quot; ...
##  $ Total  : num [1:1045] 318 405 525 625 309 405 534 634 634 314 ...
##  $ HP     : num [1:1045] 45 60 80 80 39 58 78 78 78 44 ...
##  $ Attack : num [1:1045] 49 62 82 100 52 64 84 130 104 48 ...
##  $ Defense: num [1:1045] 49 63 83 123 43 58 78 111 78 65 ...
##  $ Sp. Atk: num [1:1045] 65 80 100 122 60 80 109 130 159 50 ...
##  $ Sp. Def: num [1:1045] 65 80 100 120 50 65 85 85 115 64 ...
##  $ Speed  : num [1:1045] 45 60 80 80 65 80 100 100 100 43 ...</code></pre>
<p>As you can see the data is the ‘tibble’-format. I wanted to change that and turn
the data into a dataframe. To do that I used the as.data.frame function.</p>
<pre class="r"><code>#converting tibble into df
dfp &lt;- as.data.frame(pData)
str(dfp)</code></pre>
<pre><code>## &#39;data.frame&#39;:    1045 obs. of  10 variables:
##  $ #      : num  1 2 3 3 4 5 6 6 6 7 ...
##  $ Name   : chr  &quot;Bulbasaur&quot; &quot;Ivysaur&quot; &quot;Venusaur&quot; &quot;Venusaur Mega Venusaur&quot; ...
##  $ Type   : chr  &quot;Grass Poison&quot; &quot;Grass Poison&quot; &quot;Grass Poison&quot; &quot;Grass Poison&quot; ...
##  $ Total  : num  318 405 525 625 309 405 534 634 634 314 ...
##  $ HP     : num  45 60 80 80 39 58 78 78 78 44 ...
##  $ Attack : num  49 62 82 100 52 64 84 130 104 48 ...
##  $ Defense: num  49 63 83 123 43 58 78 111 78 65 ...
##  $ Sp. Atk: num  65 80 100 122 60 80 109 130 159 50 ...
##  $ Sp. Def: num  65 80 100 120 50 65 85 85 115 64 ...
##  $ Speed  : num  45 60 80 80 65 80 100 100 100 43 ...</code></pre>
<p>If you have knowledge of Pokemon, you probably know that Eternamax is the strongest
Pokemon. However it’s just used in an NPC fight and can’t be used by the player,
which is why it has to be removed from the dataset, because it’s an extreme outlier.
This can be done multiple ways, I just chose to use the subset function, as I’ve
never used it.</p>
<pre class="r"><code>#removing Eternamax
max(dfp$Total)</code></pre>
<pre><code>## [1] 1125</code></pre>
<pre class="r"><code>pokemon_data &lt;- subset(dfp, dfp$Total&lt;1125)</code></pre>
<p>After finalizing the dataframe I wanted to work with, I wrote a function called
‘quickAnalysis’. Pokemon have different stats, for example attack or defense.
This function returns a list with the mean, median, max and min of a stat.
The function takes 2 arguments: x, i.e. the column of the dataframe and col, i.e.
the perticular column. I chose to do it this way, so that the function can also return
the name of the stat.</p>
<pre class="r"><code>quickAnalysis &lt;- function(x, col){
  v_mean &lt;- mean(x)
  v_median &lt;- median(x)
  v_max &lt;- max(x)
  v_min &lt;- min(x)
  ql &lt;- list(v_mean, v_median, v_max, v_min)
  names(ql) &lt;- c(paste(&quot;Mean of&quot;, names(dfp)[col], &quot;Stat&quot;), 
                 paste(&quot;Median of&quot;, names(dfp)[col], &quot;Stat&quot;), 
                 paste(&quot;Max of&quot;, names(dfp)[col], &quot;Stat&quot;),
                 paste(&quot;Min of&quot;, names(dfp)[col], &quot;Stat&quot;))
  return(ql)
}</code></pre>
<p>We can plug in the different stats into the function now.</p>
<pre class="r"><code>#total
quickAnalysis(pokemon_data[,4], 4)</code></pre>
<pre><code>## $`Mean of Total Stat`
## [1] 438.658
## 
## $`Median of Total Stat`
## [1] 458
## 
## $`Max of Total Stat`
## [1] 780
## 
## $`Min of Total Stat`
## [1] 175</code></pre>
<pre class="r"><code>#hp
quickAnalysis(pokemon_data[,5], 5)</code></pre>
<pre><code>## $`Mean of HP Stat`
## [1] 69.8908
## 
## $`Median of HP Stat`
## [1] 68
## 
## $`Max of HP Stat`
## [1] 255
## 
## $`Min of HP Stat`
## [1] 1</code></pre>
<pre class="r"><code>#att
quickAnalysis(pokemon_data[,6], 6)</code></pre>
<pre><code>## $`Mean of Attack Stat`
## [1] 80.43391
## 
## $`Median of Attack Stat`
## [1] 77
## 
## $`Max of Attack Stat`
## [1] 190
## 
## $`Min of Attack Stat`
## [1] 5</code></pre>
<pre class="r"><code>#def
quickAnalysis(pokemon_data[,7], 7)</code></pre>
<pre><code>## $`Mean of Defense Stat`
## [1] 74.4933
## 
## $`Median of Defense Stat`
## [1] 70
## 
## $`Max of Defense Stat`
## [1] 230
## 
## $`Min of Defense Stat`
## [1] 5</code></pre>
<pre class="r"><code>#spatk
quickAnalysis(pokemon_data[,8], 8)</code></pre>
<pre><code>## $`Mean of Sp. Atk Stat`
## [1] 72.97222
## 
## $`Median of Sp. Atk Stat`
## [1] 65
## 
## $`Max of Sp. Atk Stat`
## [1] 194
## 
## $`Min of Sp. Atk Stat`
## [1] 10</code></pre>
<pre class="r"><code>#spdef
quickAnalysis(pokemon_data[,9], 9)</code></pre>
<pre><code>## $`Mean of Sp. Def Stat`
## [1] 72.11877
## 
## $`Median of Sp. Def Stat`
## [1] 70
## 
## $`Max of Sp. Def Stat`
## [1] 230
## 
## $`Min of Sp. Def Stat`
## [1] 20</code></pre>
<pre class="r"><code>#speed
quickAnalysis(pokemon_data[,10], 10)</code></pre>
<pre><code>## $`Mean of Speed Stat`
## [1] 68.74904
## 
## $`Median of Speed Stat`
## [1] 65
## 
## $`Max of Speed Stat`
## [1] 200
## 
## $`Min of Speed Stat`
## [1] 5</code></pre>
<p>As you can see the max total stat of any Pokemon is 780, while the min is 175.
That’s quite a big margin. To visualize the distribution of the Pokemon totals we can
use a histogram.</p>
<pre class="r"><code>#plotting data:
ht &lt;- ggplot(pokemon_data, aes(x=Total)) + geom_histogram(binwidth = 10, color=&quot;black&quot;, fill=&quot;white&quot;) +
  scale_x_continuous(breaks = seq(0, 1150, 50)) +
  geom_vline(xintercept = mean(pokemon_data$Total), col=&quot;blue&quot;, linetype = &quot;dashed&quot;, size = 1) +
  geom_density(fill=&quot;red&quot;, alpha=.2, aes(y=10 * ..count..,))

ht</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>Here we can see the mean of the total stat, which is ~440. We can also see that
the most common total base stats are between 480 and 500.</p>
<p>But what are the best and the worst Pokemon? To find this out we can combine
our quickAnalysis function with dplyr’s filter function.</p>
<pre class="r"><code>best_pkmn &lt;- pokemon_data %&gt;%
  filter(Total==unlist(quickAnalysis(pokemon_data[,4], 4)[3]))
best_pkmn[,2:4]</code></pre>
<pre><code>##                     Name             Type Total
## 1   Mewtwo Mega Mewtwo X Psychic Fighting   780
## 2   Mewtwo Mega Mewtwo Y          Psychic   780
## 3 Rayquaza Mega Rayquaza    Dragon Flying   780</code></pre>
<p>The best Pokemon are the mega evolutions of Mewtwo and Rayquaza with a base stat total of 780.</p>
<pre class="r"><code>worst_pkmn &lt;- pokemon_data %&gt;%
  filter(Total==unlist(quickAnalysis(pokemon_data[,4], 4)[4]))
worst_pkmn[,2:4]</code></pre>
<pre><code>##                   Name  Type Total
## 1 Wishiwashi Solo Form Water   175</code></pre>
<p>And the worst Pokemon is Wishiwashi’s solo form with a base stat total of 175.</p>
<p>I also wanted to make a boxplot showing the different stats. To do that we had
to reshape our dataframe from a wide-format to a long-format.</p>
<pre class="r"><code>#reshaping data to plot
plotDF &lt;- data.frame(type=c(rep(names(pokemon_data)[5], 1044), 
                            rep(names(pokemon_data)[6], 1044),
                            rep(names(pokemon_data)[7], 1044),
                            rep(names(pokemon_data)[8], 1044),
                            rep(names(pokemon_data)[9], 1044),
                            rep(names(pokemon_data)[10], 1044)),
                     value=c(pokemon_data[,5],
                             pokemon_data[,6],
                             pokemon_data[,7],
                             pokemon_data[,8],
                             pokemon_data[,9],
                             pokemon_data[,10]))

head(plotDF)</code></pre>
<pre><code>##   type value
## 1   HP    45
## 2   HP    60
## 3   HP    80
## 4   HP    80
## 5   HP    39
## 6   HP    58</code></pre>
<p>Now we are able to create a boxplot.</p>
<pre class="r"><code>d_stats &lt;- ggplot(plotDF, aes(x=value, y=type, color=type)) +
  geom_boxplot()
d_stats</code></pre>
<p><img src="{{< blogdown/postref >}}index_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>We can see again that the attack stat has the highest median.
It’s also visible that the HP stat has a lot of outliers.</p>
<p>As always you can find the code for the <a href="https://github.com/SvenNekula/webcrawler" target="_blank">crawler</a> and the
<a href="https://github.com/SvenNekula/CrawlerAnalysis" target="_blank">analysis</a> on
my GitHub.
That’s it for this post. Thanks for reading, see you again next time!</p>
<p>-SN</p>
</div>
